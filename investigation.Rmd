---
title: "IDS investigation worksheet"
author: "by Team-Name: User1, User2, User3, User4 & User5"
date: "`r Sys.Date()`"
output: html_document
---

**Note:** You can use this file as you 'working document' where you can try out various investigation ideas and keep notes about your findings. How you use and structure this file is up to you. It is recommended that you keep notes about what you are investigating and what you find as this will make the process of creating your presentation and report easier. Please note that you _do not_ need to submit this file as part of your group project.



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-lib, message = FALSE}
library(tidyverse)
library(readr)
library(dplyr)
library(janitor)
library(readxl)
library(lubridate)

```


```{r load-data}
prison_pop_by_crime_2002_2015_forreal <- read_csv("data/prison_pop_by_crime_2002-2015-forreal.csv", 
                                                  col_types = cols(...32 = col_skip(), 
                                                                   ...33 = col_skip(), ...34 = col_skip(), 
                                                                   `30-Jun-02` = col_number(), `30-Jun-03` = col_number(), 
                                                                   `30-Jun-04` = col_number(), `30-Jun-05` = col_number(), 
                                                                   `30-Jun-06` = col_number(), `30-Jun-07` = col_number(), 
                                                                   `30-Jun-08` = col_number(), `30-Jun-09` = col_number(), 
                                                                   `30-Jun-09(1)` = col_number(), `30-Jun-10` = col_number(), 
                                                                   `30-Sep-10` = col_number(), `31-Dec-10` = col_number(), 
                                                                   `31-Mar-11` = col_number(), `30-Jun-11` = col_number(), 
                                                                   `30-Sep-11` = col_number(), `31-Dec-11` = col_number(), 
                                                                   `31-Mar-12` = col_number(), `30-Jun-12` = col_number(), 
                                                                   `30-Sep-12` = col_number(), `31-Dec-12` = col_number(), 
                                                                   `31-Mar-13` = col_number(), `30-Jun-13` = col_number(), 
                                                                   `30-Sep-13` = col_number(), `31-Dec-13` = col_number(), 
                                                                   `31-Mar-14` = col_number(), `30-Jun-14` = col_number(), 
                                                                   `30-Sep-14` = col_number(), `31-Dec-14` = col_number(), 
                                                                   `31-Mar-15` = col_number(), `30-Jun-15` = col_number()), 
                                                  skip = 1)

prison_pop_by_crime_2015_2023_forrealforrealforsure <- read_csv("data/prison_pop_by_crime_2015-2023-forrealforrealforsure.csv", 
                                                                skip = 1)

earliercrimes <- prison_pop_by_crime_2002_2015_forreal %>% 
  slice(2:11)
view(earliercrimes)

latercrimes <- prison_pop_by_crime_2015_2023_forrealforrealforsure %>% 
  slice(2:14)
view(latercrimes)


#pivotting earlier data
earlierpivoted <- (earliercrimes %>% 
    pivot_longer(
      cols = c(-"...1"),
      names_to = 'date',
      values_to = "numconvicts"
    )) %>%
  pivot_wider(
    names_from = "...1",
    values_from = "numconvicts"
  ) %>% 
  clean_names(earlierpivoted)

#pivoting later data
laterpivoted <- (latercrimes %>% 
                   pivot_longer(
                     cols = c(-"...1"),
                     names_to = 'date',
                     values_to = "numconvicts"
                   )) %>%
  pivot_wider(
    names_from = "...1",
    values_from = "numconvicts") %>% 
  clean_names(laterpivoted)

#this isnt working?
earlierpivoted %>% 
  mutate(
    theft_offences = (burglary + theft_and_handling)
  )
```

```{r }
library(tidyverse)
library(readr)
Population_30June2023_Annual_Sentencelength<- read_csv("data/Population_30June2023_Annual_Sentencelength - Copy.csv")

# split into women and men
Women.sentence.lengths <- Population_30June2023_Annual_Sentencelength %>%
  slice(1,34:49)

Male.sentence.lengths <- Population_30June2023_Annual_Sentencelength %>%
  slice(1,18:33)

sentencelengthspivoted <- (Women.sentence.lengths %>% 
    pivot_longer(
      cols = c("Table A1.6: Prison population under immediate custodial sentence by sentence length, offence group and sex; 30 June 2023"),
      names_to = 'sentence lengths',
      values_to = "numconvicts"
    )) 


# fixing the titles of the columns
colnames(Women.sentence.lengths) <- Women.sentence.lengths[1, ]
Women.sentence.lengths <- Women.sentence.lengths[-2, ]
rownames(Women.sentence.lengths) <- NULL

colnames(Male.sentence.lengths) <- Male.sentence.lengths[1, ]
Male.sentence.lengths <- Male.sentence.lengths[-2, ]
rownames(Male.sentence.lengths) <- NULL


#splitting into violent and non violent crimes
colnames(Male.sentence.lengths)[is.na(colnames(Male.sentence.lengths))][1] <- "Sentence length"

Male.sentence.lengths.V <- select(Male.sentence.lengths, 1, 2, 3, 4, 6, 8) %>% 
  slice(-1)

Male.sentence.lengths.nV <- select(Male.sentence.lengths, 1, 5, 7, 9, 10, 11, 12, 13) %>% 
  slice(-1)

colnames(Women.sentence.lengths)[is.na(colnames(Women.sentence.lengths))][1] <- "Sentence length"

Women.sentence.lengths.V <- select(Women.sentence.lengths, 1, 2, 3, 4, 6, 8) %>% 
  slice(-1)

Women.sentence.lengths.nV <- select(Women.sentence.lengths, 1, 5, 7, 9, 10, 11, 12, 13) %>% 
  slice(-1)


# make all variables numeric
Male.sentence.lengths.V$`Violence against the person`<- parse_number(Male.sentence.lengths.V$`Violence against the person`)

Male.sentence.lengths.V$`Sexual offences`<- parse_number(Male.sentence.lengths.V$`Sexual offences`)

Male.sentence.lengths.V$Robbery<- parse_number(Male.sentence.lengths.V$Robbery)

Male.sentence.lengths.V$`Criminal damage and arson`<- parse_number(Male.sentence.lengths.V$`Criminal damage and arson`)

Male.sentence.lengths.V$`Possession of weapons`<- parse_number(Male.sentence.lengths.V$`Possession of weapons`)


Women.sentence.lengths.V$`Violence against the person`<- parse_number(Women.sentence.lengths.V$`Violence against the person`)

Women.sentence.lengths.V$`Sexual offences`<- parse_number(Women.sentence.lengths.V$`Sexual offences`)

Women.sentence.lengths.V$Robbery<- parse_number(Women.sentence.lengths.V$Robbery)

Women.sentence.lengths.V$`Criminal damage and arson`<- parse_number(Women.sentence.lengths.V$`Criminal damage and arson`)

Women.sentence.lengths.V$`Possession of weapons`<- parse_number(Women.sentence.lengths.V$`Possession of weapons`)




Male.sentence.lengths.nV$`Theft Offences`<- parse_number(Male.sentence.lengths.nV$`Theft Offences`)

Male.sentence.lengths.nV$`Drug offences`<- 
  parse_number(Male.sentence.lengths.nV$`Drug offences`)

Male.sentence.lengths.nV$`Public order offences` <- parse_number(Male.sentence.lengths.nV$`Public order offences`)

Male.sentence.lengths.nV$`Miscellaneous crimes against society`<- parse_number(Male.sentence.lengths.nV$`Miscellaneous crimes against society`)

Male.sentence.lengths.nV$`Fraud Offences`<- parse_number(Male.sentence.lengths.nV$`Fraud Offences`)

Male.sentence.lengths.nV$`Summary Non-Motoring` <- parse_number(Male.sentence.lengths.nV$`Summary Non-Motoring`)

Male.sentence.lengths.nV$`Summary motoring` <- parse_number(Male.sentence.lengths.nV$`Summary motoring`)



Women.sentence.lengths.nV$`Theft Offences`<- parse_number(Women.sentence.lengths.nV$`Theft Offences`)

Women.sentence.lengths.nV$`Drug offences`<- 
  parse_number(Women.sentence.lengths.nV$`Drug offences`)

Women.sentence.lengths.nV$`Public order offences` <- parse_number(Women.sentence.lengths.nV$`Public order offences`)

Women.sentence.lengths.nV$`Miscellaneous crimes against society`<- parse_number(Women.sentence.lengths.nV$`Miscellaneous crimes against society`)

Women.sentence.lengths.nV$`Fraud Offences`<- parse_number(Women.sentence.lengths.nV$`Fraud Offences`)

Women.sentence.lengths.nV$`Summary Non-Motoring` <- parse_number(Women.sentence.lengths.nV$`Summary Non-Motoring`)

Women.sentence.lengths.nV$`Summary motoring` <- parse_number(Women.sentence.lengths.nV$`Summary motoring`)

Male.sentence.lengths.nV <- janitor::clean_names(Male.sentence.lengths.nV)

Male.sentence.lengths.V <- janitor::clean_names(Male.sentence.lengths.V)

Women.sentence.lengths.nV <- janitor::clean_names(Women.sentence.lengths.nV)

Women.sentence.lengths.V <- janitor::clean_names(Women.sentence.lengths.V)


# Make a totals and percentage totals column 

Male.sentence.lengths.V <- 
mutate(Male.sentence.lengths.V, 
       total = rowSums(across(2:5)), 
       Percentage_of_total = (total / 66583)*100)

Women.sentence.lengths.V <- mutate(Women.sentence.lengths.V, 
       total = rowSums(across(2:5)), 
       Percentage_of_total = (total / 2181)*100)

Male.sentence.lengths.nV <- mutate(Male.sentence.lengths.nV, 
       total = rowSums(across(2:8)), 
       Percentage_of_total = (total / 40160)*100)

Women.sentence.lengths.nV <- mutate(Women.sentence.lengths.nV, 
       total = rowSums(across(2:8)), 
       Percentage_of_total = (total / 1770)*100)

summarise(Women.sentence.lengths.nV, sum(total))
summarise(Male.sentence.lengths.nV, sum(total))
summarise(Women.sentence.lengths.V, sum(total))
summarise(Male.sentence.lengths.V, sum(total))


# making violent and non violent crimes tables with women and men

Non_Violent_Crimes <- full_join(Women.sentence.lengths.nV, Male.sentence.lengths.nV) %>% 
  mutate(Gender = case_when(
    row_number() <= 15 ~ "Female",
  TRUE ~ "Male"))
view(Non_Violent_Crimes)

Violent_Crimes <- full_join(Women.sentence.lengths.V, Male.sentence.lengths.V) %>% 
  mutate(Gender = case_when(
    row_number() <= 15 ~ "Female",
  TRUE ~ "Male"))
View(Violent_Crimes)

Crimes <- full_join(Non_Violent_Crimes, Violent_Crimes)
view(Crimes)



# graphing the proportion of crime types by gender

Graphing_V_Crimes <-
  select(Violent_Crimes, 
         Gender, 
         violence_against_the_person:possession_of_weapons) %>%
  pivot_longer(cols = -Gender, 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Graphing_V_Crimes, 
       aes(
         x = crime_type, 
         y = count, 
         fill = Gender)) +
  geom_col(position = "fill") +
  coord_flip() +
  labs(title = "Proportion of Crime Types by Gender",
       subtitle = "Violent Crimes",
       x = "Crime Type", 
       y = "Proportion") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "lightblue"))

Graphing_nV_Crimes <-
  select(Non_Violent_Crimes, 
         Gender, 
         theft_offences:summary_motoring) %>%
  pivot_longer(cols = -Gender, 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Graphing_nV_Crimes, 
       aes(
         x = crime_type, 
         y = count, fill = Gender)) +
  geom_col(position = "fill") +
  coord_flip() +
  labs(title = "Proportion of Crime Types by Gender",
       subtitle = "Non-Violent Crimes",
       x = "Crime Type", y = "Proportion") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "lightblue"))



# plotting pie charts of the proportion of different crime types by each group of people

Women.sentence.lengths.V.Pivoted <-  summarise(Women.sentence.lengths.V, across(violence_against_the_person:possession_of_weapons, sum)) %>%
  pivot_longer(everything(), 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Women.sentence.lengths.V.Pivoted, 
       aes(
         x = "", 
         y = count, 
         fill = crime_type)) +
  geom_bar(stat = "identity", 
           width = 1) +
  coord_polar("y") +
  labs(title = "Female Violent Offenders: Crime Type Distribution")

Male.sentence.lengths.V.Pivoted <-  
  summarise(Male.sentence.lengths.V, 
            across(
    violence_against_the_person:possession_of_weapons, 
    sum)) %>%
  pivot_longer(everything(), 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Male.sentence.lengths.V.Pivoted, 
       aes(
         x = "", 
         y = count, 
         fill = crime_type)) +
  geom_bar(stat = "identity", 
           width = 1) +
  coord_polar("y") +
  labs(title = "Male Violent Offenders: Crime Type Distribution")

Women.sentence.lengths.nV.Pivoted <-  summarise(Women.sentence.lengths.nV, across(theft_offences:summary_motoring, 
                         sum)) %>%
  pivot_longer(everything(), 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Women.sentence.lengths.nV.Pivoted, 
       aes(
         x = "", 
         y = count, 
         fill = crime_type)) +
  geom_bar(stat = "identity", 
           width = 1) +
  coord_polar("y") +
  labs(title = "Female Non Violent Offenders: Crime Type Distribution")

Male.sentence.lengths.nV.Pivoted <-  summarise(Male.sentence.lengths.nV, 
                                               across(theft_offences:summary_motoring, 
                                           sum)) %>%
  pivot_longer(everything(), 
               names_to = "crime_type", 
               values_to = "count")

ggplot(Male.sentence.lengths.nV.Pivoted, 
       aes(
         x = "", 
         y = count, 
         fill = crime_type)) +
  geom_bar(stat = "identity", 
           width = 1) +
  coord_polar("y") +
  labs(title = "Male Non Violent Offenders: Crime Type Distribution")


# histogram with changing the first column to numeric variables against total people to see the distribution



```

```{r}
# REMOVING AND RENAMING COLUMNS

table_2002_2015 <- A1_4_2002_2015 %>%
  select(-c(10,12,13,14,16,17,18,20,21,22,24,25,26,28,29,30)) %>%
  
  rename("30-Jun-02" = "...2",
         "30-Jun-03" = "...3",
         "30-Jun-04" = "...4",
         "30-Jun-05" = "...5",
         "30-Jun-06" = "...6",
         "30-Jun-07" = "...7",
         "30-Jun-08" = "...8",
         "30-Jun-09" = "...9",
         "30-Jun-10" = "...11",
         "30-Jun-11" = "...15",
         "30-Jun-12" = "...19",
         "30-Jun-13" = "...23",
         "30-Jun-14" = "...27",
         "30-Jun-15" = "Contents") %>%
  rename_at(1, ~"Type")

table_2015_2023 <- A1_4_2015_2023 %>%
  select(1,2,6,10,14,18,22,26,30,34) %>%
  
  rename_at(1, ~"Type") %>%
  rename("30-Jun-15" = "...2",
         "30-Jun-16" = "...6",
         "30-Jun-17" = "...10",
         "30-Jun-18" = "...14",
         "30-Jun-19" = "...18",
         "30-Jun-20" = "...22",
         "30-Jun-21" = "...26",
         "30-Jun-22" = "...30",
         "30-Jun-23" = "Contents")

# DROP 2015 IN EARLY COLUMN (added after)
table_2002_2015 <- table_2002_2015 %>%
  mutate(`30-Jun-15`=NULL)

# SLICING - COMPLETE 

early_adults <- table_2002_2015 %>%
  slice(14:23)

early_18_20 <- table_2002_2015 %>%
  slice(24:34)

early_15_17 <- table_2002_2015 %>%
  slice(35:45)

later_adults <- table_2015_2023 %>%
  slice(17:29)

later_18_20 <- table_2015_2023 %>%
  slice(31:43)

later_15_17 <- table_2015_2023 %>%
  slice(45:57)


# PIVOTING 

#ADULTS 

pivot_2002 <- early_adults %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  )
pivot_2002 <- pivot_2002 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names()

pivot_2015 <- later_adults %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  ) 
pivot_2015 <- pivot_2015 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names()

# 18-20
# need to sort out 30-jun-15 column as its a character
# drop because we already have data for 2015

pivot_2002_18_20 <- early_18_20 %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  )
pivot_2002_18_20 <- pivot_2002_18_20 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names() %>%
  mutate(x18_20_year_olds = NULL)

pivot_2015_18_20 <- later_18_20 %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  )
pivot_2015_18_20 <- pivot_2015_18_20 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names()

# 15-17

pivot_2002_15_17 <- early_15_17 %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  )
pivot_2002_15_17 <- pivot_2002_15_17 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names() %>%
  mutate(x15_17_year_olds = NULL)
  
pivot_2015_15_17 <- later_15_17 %>%
  pivot_longer(
    cols = c(-"Type"),
    names_to = "date",
    values_to = "numconvicts"
  )
pivot_2015_15_17 <- pivot_2015_15_17 %>%
  pivot_wider(
    names_from = "Type",
    values_from = "numconvicts"
  ) %>%
  clean_names()

# COMBINE COLUMNS

# ADULTS
pivot_2015_combined_cols <- pivot_2015 %>%
  mutate(other_offences = criminal_damage_and_arson + possession_of_weapons + public_order_offences + miscellaneous_crimes_against_society + summary_non_motoring,
         motoring_offences = summary_non_motoring) %>%
  select(date, violence_against_the_person, sexual_offences, robbery, theft_offences, drug_offences, fraud_offences, motoring_offences, other_offences, offence_not_recorded) %>%
  select(order(colnames(pivot_2015_combined_cols)))

pivot_2002_combined_cols <- pivot_2002 %>%
  mutate(theft_offences = burglary + theft_and_handling,
         fraud_offences = fraud_and_forgery) %>%
  select(-c(burglary, theft_and_handling, fraud_and_forgery)) %>%
  select(order(colnames(pivot_2002_combined_cols)))

# 18-20
pivot_2015_18_20_combined_cols <- pivot_2015_18_20 %>%
  mutate(other_offences = criminal_damage_and_arson + possession_of_weapons + public_order_offences + miscellaneous_crimes_against_society + summary_non_motoring,
         motoring_offences = summary_non_motoring) %>%
  select(date, violence_against_the_person, sexual_offences, robbery, theft_offences, drug_offences, fraud_offences, motoring_offences, other_offences, offence_not_recorded) 

pivot_2002_18_20_combined_cols <- pivot_2002_18_20 %>%
  mutate(theft_offences = burglary + theft_and_handling,
         fraud_offences = fraud_and_forgery) %>%
  select(-c(burglary, theft_and_handling, fraud_and_forgery))

# 15-17
pivot_2015_15_17_combined_cols <- pivot_2015_15_17 %>%
  mutate(other_offences = criminal_damage_and_arson + possession_of_weapons + public_order_offences + miscellaneous_crimes_against_society + summary_non_motoring,
         motoring_offences = summary_non_motoring) %>%
  select(date, violence_against_the_person, sexual_offences, robbery, theft_offences, drug_offences, fraud_offences, motoring_offences, other_offences, offence_not_recorded)

pivot_2002_15_17_combined_cols <- pivot_2002_15_17 %>%
  mutate(theft_offences = burglary + theft_and_handling,
         fraud_offences = fraud_and_forgery) %>%
  select(-c(burglary, theft_and_handling, fraud_and_forgery))

# JOIN TABLES 

adults <- full_join(x = pivot_2002_combined_cols,
          y = pivot_2015_combined_cols)

table_18_20 <- full_join(x = pivot_2002_18_20_combined_cols,
                         y = pivot_2015_18_20_combined_cols)

table_15_17 <- full_join(x = pivot_2002_15_17_combined_cols,
                         y = pivot_2015_15_17_combined_cols)


# COMBINE ALL TABLES WITH AGE

adults <- adults %>%
  mutate(age = "adult")
table_18_20 <- table_18_20 %>%
  mutate(age = "18-20")
table_15_17 <- table_15_17 %>%
  mutate(age = "15-17")

whole_table <- full_join(adults, table_18_20)
whole_table <- full_join(whole_table, table_15_17)


# MAKING DATE COLUMN DATE DATA TYPE

whole_table <- whole_table %>%
  mutate(date = dmy(date))

# PLOTS

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = violence_against_the_person,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = sexual_offences,
                     colour = age)) +
  geom_line()


ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = robbery,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = drug_offences,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = robbery,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = motoring_offences,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = theft_offences,
                     colour = age)) +
  geom_line()

ggplot(data = whole_table,
       mapping = aes(x = date,
                     y = fraud_offences,
                     colour = age)) +
  geom_line()

```

